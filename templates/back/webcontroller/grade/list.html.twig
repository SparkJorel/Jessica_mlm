{% extends 'base.html.twig' %}
{% block title %} JTWC - Grades et informations complémentaires {% endblock %}
{% block page_title %} Grades et informations complémentaires {% endblock %}
{% block main %}
    <div class="col-lg-12">
        <div class="content-panel">
		    {% for type, messages in app.session.flashbag.all() %}
                {% for message in messages %}
                    <div class="alert alert-{{type}}">{{message}}</div>
                {% endfor %}
            {% endfor %}
			<h4>
                {% if app.user and is_granted('IS_AUTHENTICATED_FULLY') and is_granted('ROLE_JTWC_ADMIN') %}
                    <a href="{{ path('grade_new') }}"><button type="button" class="btn btn-primary"><span class="fa fa-plus-circle"></span>Ajouter un nouveau grade</button></a>
                {% endif %}
            </h4>        
            <section id="unseen">
                <table class="table table-bordered table-striped table-condensed">
                    <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Bonus Spécial</th>
                        <th>Maintenance</th></th>
                        <th>SV</th>
                        <th>Level</th>
                        <th colspan="3">Générationnel</th>
                        {% if app.user and is_granted('IS_AUTHENTICATED_FULLY') and is_granted('ROLE_JTWC_ADMIN') %}
                            <th>Actions</th>
                        {% endif %}
                    </tr>
                    </thead>
                    <tbody>
                    {% for grade in grades %}
                        <tr>
                            <td rowspan="{{ grade['generational']|length }}">{{ grade.commercialName }}</td>
                            <td rowspan="{{ grade['generational']|length }}">
                                <input data-toggle="toggle" data-on="Oui"
                                       data-off="Non" class="condition"
                                       type="checkbox"
                                        {% if grade.rewardable %} checked {% endif %} />
                            </td>
                            <td rowspan="{{ grade['generational']|length }}">{{ grade.maintenance|number_format(2, ',', ' ') }}</td>
                            <td rowspan="{{ grade['generational']|length }}">{{ grade.sv|number_format(2, ',', ' ') }}</td>
                            <td rowspan="{{ grade['generational']|length }}">{{ grade.lvl|number_format(2, ',', ' ') }}</td>
                            <td>{{ grade['generational'][0]['level'] }}</td>
                            <td>{{ grade['generational'][0]['name'] }}</td>
                            <td>{{ grade['generational'][0]['value']|number_format(2, ',', ' ') }}</td>
                            {% if app.user and is_granted('IS_AUTHENTICATED_FULLY') and is_granted('ROLE_JTWC_ADMIN') %}
                                <td rowspan="{{ grade['generational']|length }}">
                                    <a href="{{ path('grade_edit', {'id': grade['id']})}}" title="Edit" class="btn btn-info btn-xs"><span class="fa fa-edit"></span></a>
                                    <button type="button" class="btn btn-danger btn-xs" title="Delete" data-toggle="modal" data-target="#gradeDeleteDialog{{grade['id']}}"><span class="fa fa-remove"></span>
                                    </button>
                                    <div class="modal fade" id="gradeDeleteDialog{{grade['id']}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                    <h4 class="modal-title" id="myModalLabel">Confirmation needed</h4>
                                                </div>
                                                <div class="modal-body">
                                                    Voulez vous vraiment supprimer ce grade ?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">Abandonner</button>
                                                    <form action="{{ path('grade_delete', {'id': grade['id'] }) }}" method="post">
                                                        <button type="button" class="btn btn-danger">Confirmer</button>
                                                        <input type="hidden" name="_jtwc_grade_token"  value="{{ csrf_token('jtwc_grade-delete'~grade['id']) }}" />
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            {% endif %}
                        </tr>
                        {% set end_range = grade['generational']|length - 1 %}
                        {% if end_range > 0 %}
                            {% for i in range(1, end_range) %}
                                <tr>
                                    <td>{{ grade['generational'][i]['level'] }}</td>
                                    <td>{{ grade['generational'][i]['name'] }}</td>
                                    <td>{{ grade['generational'][i]['value']|number_format(2, ',', ' ') }}</td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                    {% else %}
                        <tr>
                            <td {% if app.user and is_granted('IS_AUTHENTICATED_FULLY') and
                                is_granted('ROLE_JTWC_ADMIN') %} colspan="9"
                            {% else %} colspan="8"
                                    {% endif %}>Pas de grades disponibles dans le système
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </section>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('toggle_boolean_button') }}
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('toggle_boolean_button') }}
{% endblock %}